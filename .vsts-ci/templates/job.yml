parameters:
  condition: always()
  jobName: ''
  poolName: ''
  vmImage: ''
  dockerfile: powershell/build/base/Dockerfile

jobs:

- job: ${{ parameters.jobName }}
  condition: ${{ parameters.condition }}

  pool:
    ${{ if ne(parameters.poolName, '') }}:
      name: ${{ parameters.poolName }}
    ${{ if ne(parameters.vmImage, '') }}:
      vmImage: ${{ parameters.vmImage }}

  steps:
  - powershell: docker info
    displayName: Get docker info

  - powershell: (Get-ComputerInfo).WindowsBuildLabEx
    displayName: Get WindowsBuildLabEx

  # - powershell: docker system prune --all --volumes --force
  #   displayName: docker system prune --all --volumes --force

  - task: Docker@2
    displayName: build
    inputs:
      command: build
      repository: 'travisez13/powershell_build_base'
      Dockerfile: ${{ parameters.dockerfile }}
      arguments: ${{ parameters.arguments }}
      tags: |
        latest
        $(Build.BuildNumber)
